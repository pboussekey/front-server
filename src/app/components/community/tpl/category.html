<div class="col_left small" ng-if="ctrl.category.key !== 'all' && ctrl.category.filters.length" id="community-filters">
    <div sticky>
        <div class="filter-block"
            ng-if="ctrl.category.filters.indexOf('organization') !== -1">
            <h2 class="title">Institutions</h2>

            <div class="tags">
                <form >
                  <input ng-repeat-start="tag in ctrl.suggestions['organization']" type="checkbox"
                      ng-model="ctrl.checkboxes['organization' + $index]"
                      id="organization-{{$index}}"
                      ng-click="ctrl.toggleFilter(tag, 'organization')"
                      ng-checked="ctrl.filters.organization.indexOf(tag) >= 0" />
                  <label ng-repeat-end for="organization-{{$index}}" title="{{ctrl.pages[tag].datum.title}}" >{{ ctrl.pages[tag].datum.title }}</label>
                      <div class="autocomplete input-block"  ng-show="ctrl.showTags['organization']"
                          ui-autocomplete="ctrl.searchOrganization"
                          autocomplete-id="searchSchoolInput"
                          autocomplete-items="ctrl.organizations"
                          autocomplete-pagination="10"
                          autocomplete-search="ctrl.autocomplete"
                          placeholder="Click to see institutions"
                          min-length="0">
                              <button
                                  ng-repeat="item in ctrl.organizations"
                                  ng-click="ctrl.toggleFilter(item, 'organization'); ctrl.showTags['organization'] = false;"
                                  autocomplete-result="{{ ctrl.pages[item].datum.title }}"
                                  result-image="{{ctrl.pages[item].datum.logo}}"
                                  result-search="ctrl.autocomplete.search"
                                  type="button" >
                              </button>
                      </div>
                      <label for="searchSchoolInput"  ng-show="!ctrl.showTags['organization']"
                              class="cta light i-plus " ng-click="ctrl.showTags['organization'] = true">
                              More institutions...
                      </label>
                </form>
            </div>
        </div>
        <div class="filter-block"  ng-if="ctrl.category.filters.indexOf('tags') !== -1">
            <h2 class="title">Location</h2>
            <div class="tags">
                <form >
                  <input ng-repeat-start="tag in ctrl.suggestions['address']" type="checkbox"
                      ng-model="ctrl.checkboxes['address' + $index]"
                      id="address-{{$index}}"
                      ng-click="ctrl.toggleTagFilter(tag)"
                      ng-checked="ctrl.isInSearch(tag)" />
                  <label ng-repeat-end for="address-{{$index}}" title="{{tag}}" >{{ tag }}</label>
                      <div class="autocomplete input-block"  ng-show="ctrl.showTags['address']"
                          ui-autocomplete="ctrl.searchTags['address']"
                          autocomplete-id="searchaddress"
                          placeholder="Search for locations"
                          autocomplete-search="ctrl.input_tags['address']"
                          autocomplete-items="ctrl.tags_list"
                          min-length="0">
                              <button
                                  ng-repeat="item in ctrl.tags_list"
                                  ng-click="ctrl.toggleTagFilter(item.name, 'address'); ctrl.showTags['address'] = false;"
                                  autocomplete-result="{{item.name}}"
                                  result-search="ctrl.input_tags['address'].search"
                                  type="button" >
                              </button>
                      </div>
                      <label for="searchaddress"  ng-show="!ctrl.showTags['address']"
                              class="cta light i-plus " ng-click="ctrl.showTags['address'] = true">
                              More locations...
                      </label>
                </form>
            </div>

        </div>
        <div class="filter-block"  ng-if="ctrl.category.filters.indexOf('tags') !== -1">
            <h2 class="title">Country of origin</h2>
            <div class="tags">
                <form >
                  <input ng-repeat-start="tag in ctrl.suggestions['origin']" type="checkbox"
                      ng-model="ctrl.checkboxes['origin' + $index]"
                      id="origin-{{$index}}"
                      ng-click="ctrl.toggleTagFilter(tag)"
                      ng-checked="ctrl.isInSearch(tag)" />
                  <label ng-repeat-end for="origin-{{$index}}" title="{{tag}}" >{{ tag }}</label>
                      <div class="autocomplete input-block"  ng-show="ctrl.showTags['origin']"
                          ui-autocomplete="ctrl.searchTags['origin']"
                          autocomplete-id="searchorigin"
                          placeholder="Search for countries"
                          autocomplete-search="ctrl.input_tags['origin']"
                          autocomplete-items="ctrl.tags_list"
                          min-length="0">
                              <button
                                  ng-repeat="item in ctrl.tags_list"
                                  ng-click="ctrl.toggleTagFilter(item.name, 'origin'); ctrl.showTags['origin'] = false;"
                                  autocomplete-result="{{item.name}}"
                                  result-search="ctrl.input_tags['origin'].search"
                                  type="button" >
                              </button>
                      </div>
                      <label for="searchorigin"  ng-show="!ctrl.showTags['origin']"
                              class="cta light i-plus " ng-click="ctrl.showTags['origin'] = true">
                              More countries...
                      </label>
                </form>
            </div>

        </div>
        <div class="filter-block" ng-repeat="category in ctrl.tags_constants.categories"
            ng-if="ctrl.category.filters.indexOf('tags') !== -1">
            <h2 class="title">{{ctrl.tags_constants.short[category] | plural : true}}</h2>
            <div class="tags">
                <form >
                    <input ng-repeat-start="tag in ctrl.suggestions[category]" type="checkbox"
                        ng-model="ctrl.checkboxes[category + $index]"
                        id="{{category}}-{{$index}}"
                        ng-click="ctrl.toggleTagFilter(tag)"
                        ng-checked="ctrl.isInSearch(tag)" />
                    <label ng-repeat-end for="{{category}}-{{$index}}" title="{{tag}}" >{{ tag }}</label>
                      <div class="autocomplete input-block"  ng-show="ctrl.showTags[category]"
                          ui-autocomplete="ctrl.searchTags[category]"
                          autocomplete-id="search{{category}}"
                          placeholder="Search for {{ctrl.tags_constants.short[category] | plural : true }}"
                          autocomplete-search="ctrl.input_tags[category]"
                          autocomplete-items="ctrl.tags_list"
                          min-length="0">
                              <button
                                  ng-repeat="item in ctrl.tags_list"
                                  ng-click="ctrl.toggleTagFilter(item.name, category); ctrl.showTags[category] = false;"
                                  autocomplete-result="{{item.name}}"
                                  result-search="ctrl.input_tags[category].search"
                                  type="button" >
                              </button>
                      </div>
                      <label for="search{{category}}"  ng-show="!ctrl.showTags[category]"
                              class="cta light i-plus " ng-click="ctrl.showTags[category] = true">
                              More {{ctrl.tags_constants.short[category] | plural : true}}...
                      </label>
                </form>
            </div>

        </div>
        <div class="filter-block"  ng-if="ctrl.category.filters.indexOf('tags') !== -1">
            <h2 class="title">Class year</h2>
            <div class="tags">
                <form >
                  <input ng-repeat-start="tag in ctrl.suggestions['graduation']" type="checkbox"
                      ng-model="ctrl.checkboxes['graduation' + $index]"
                      id="graduation-{{$index}}"
                      ng-click="ctrl.toggleTagFilter(tag)"
                      ng-checked="ctrl.isInSearch(tag)" />
                      <label ng-repeat-end for="graduation-{{$index}}" title="{{tag}}" >{{ tag }}</label>
                      <div class="autocomplete input-block"  ng-show="ctrl.showTags['graduation']"
                          ui-autocomplete="ctrl.searchTags['graduation']"
                          autocomplete-id="searchgraduation"
                          placeholder="Search for class years"
                          autocomplete-search="ctrl.input_tags['graduation']"
                          autocomplete-items="ctrl.tags_list"
                          min-length="0">
                              <button
                                  ng-repeat="item in ctrl.tags_list"
                                  ng-if='item.name > 0'
                                  ng-click="ctrl.toggleTagFilter(item.name, 'graduation'); ctrl.showTags['graduation'] = false;"
                                  autocomplete-result="{{item.name}}"
                                  result-search="ctrl.input_tags['graduation'].search"
                                  type="button" >
                              </button>
                      </div>
                      <label for="searchgraduation"  ng-show="!ctrl.showTags['graduation']"
                              class="cta light i-plus " ng-click="ctrl.showTags['graduation'] = true">
                              More class years...
                      </label>
                </form>
            </div>

        </div>
        <div class="filter-block"
            ng-if="ctrl.category.filters.indexOf('role') !== -1">
            <h2 class="title">Roles</h2>

            <div class="tags">
                <form >
                  <input  type="radio" name="role"
                      id="role_all"
                      ng-click="ctrl.filters.role = null;ctrl.filters.is_pinned  = null;ctrl.filters.page_type = null;ctrl.onSearch();"
                      ng-checked="ctrl.filters.role === null" />
                  <label ng-repeat-end for="role_all" title="All people" class="radio" >All people</label>
                  <input  type="radio" name="role"
                      id="role_student"
                      ng-click="ctrl.filters.role = 'user';ctrl.filters.is_pinned  = null;ctrl.filters.page_type = null;ctrl.onSearch();"
                      ng-checked="ctrl.filters.role === 'user'" />
                  <label ng-repeat-end for="role_student" title="Students" class="radio" >Students</label>
                  <input  type="radio" name="role"
                      id="role_instructor"
                      ng-click="ctrl.filters.role = null;ctrl.filters.is_pinned  = true;ctrl.filters.page_type = null;ctrl.onSearch();"
                      ng-checked="ctrl.filters.is_pinned === 1" />
                  <label ng-repeat-end for="role_instructor" title="Instructors" class="radio" >Instructors</label>
                  <input  type="radio" name="role"
                      id="role_admin"
                      ng-click="ctrl.filters.role = 'admin'; ctrl.filters.page_type = 'organization';ctrl.filters.is_pinned  = null;ctrl.onSearch()"
                      ng-checked="ctrl.filters.role === 'admin' && ctrl.filters.page_type === 'organization'" />
                  <label ng-repeat-end for="role_admin" title="Administrators" class="radio" >Administrators</label>
                </form>
            </div>
        </div>
        <div class="filter-block"
            ng-if="ctrl.category.filters.indexOf('events') !== -1">
            <h2 class="title">Events</h2>
            <div class="tags">
                <form >
                  <input  type="radio" name="events"
                      id="event_all"
                      ng-click="ctrl.filters.events = null;ctrl.onSearch();"
                      ng-checked="ctrl.filters.events === null" />
                  <label ng-repeat-end for="event_all" title="All" class="radio" >All</label>
                  <input  type="radio" name="events"
                      id="event_past"
                      ng-click="ctrl.filters.events = 'past';ctrl.onSearch();"
                      ng-checked="ctrl.filters.events === 'past'" />
                  <label ng-repeat-end for="event_past" title="Past events" class="radio" >Past events</label>
                  <input  type="radio" name="events"
                      id="event_upcoming"
                      ng-click="ctrl.filters.events = 'upcoming';ctrl.onSearch();"
                      ng-checked="ctrl.filters.events === 'upcoming'" />
                  <label ng-repeat-end for="event_upcoming" title="Upcoming events" class="radio" >Upcoming events</label>
                </form>
            </div>
        </div>
    </div>
</div>

<div ng-class="{ col_center : ctrl.category.filters.length, col_alone : !ctrl.category.filters.length }" >
    <div class="box" id="search-box">
        <div class="search-header">
            <div class="search-bar">
                  <label class="i16 i-search"  title="Search" for="communityinput">
                     <span class="for_screen_reader">Search</span>
                 </label>
                 <input ng-model="ctrl.search" id="communityinput" name="search"
                        ng-change="ctrl.onSearch()"
                        placeholder="Search..." >
                        <button class="i12 i-x"  title="Close search bar"
                         ng-if="ctrl.search"
                          ng-click="ctrl.search='';ctrl.onSearch()">
                     <span class="for_screen_reader">Empty search bar</span>
                 </button>
             </div>
             <div id="community-category">
               {{ ctrl.category.name }} <span ng-if="ctrl.category.count">({{ ctrl.category.count }})</span>
             </div>
         </div>
        <div infinite-list class="default"
             next-page="ctrl.nextPage" loading="ctrl.searching" >
            <div ng-if="ctrl.category.key === 'people'" class="user middle"
                 ng-repeat-start="id in ctrl.category.list" user="id" user-links="true" graduation="true">
                <button ng-click="ctrl.viewConnections($event, id)"
                        ng-disabled="!app.users[id].datum.contacts_count"
                        ng-class="{ u : app.users[id].datum.contacts_count }"
                        class="connections">{{ ::app.users[id].datum.contacts_count+' connection' + (app.users[id].datum.contacts_count > 1 ? 's' : '') }}</button>
                <div class="cty_actions">
                    <button class="i16 i-comment"
                        ng-if="id !== ctrl.session.id"
                        ng-click="ctrl.openConversation(id)" title="Start chatting with {{ ::app.users[id].datum|username }}">
                        <span class="for_screen_reader">Start chatting with {{ ::app.users[id].datum|username }}</span>
                    </button>
                    <cnctactions connection="app.users[id].datum" onstatechange="ctrl.refresh"></cnctactions>
                    <div usertags="id"   ng-if="id !== ctrl.session.id && app.users[id].datum.tags.length"></div>

                </div>
            </div>
            <div ng-repeat-end ng-if="ctrl.category.key !== 'people'" page-links="true" page="id">
            </div>
            <div class="empty" ng-if="!ctrl.category.list.length && !ctrl.searching">
                There is no element to display.
            </div>
        </div>
    </div>
</div>
